<!doctype html>
<html lang="da">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vinbot ‚Äì find vin p√• sekunder</title>
  <meta name="description" content="Find den perfekte vin til mad, hum√∏r eller lejlighed. Vinbot viser konkrete flasker med billeder, priser og links til de bedste butikker." />
  <link rel="stylesheet" href="/assets/styles.css" />
  <link rel="icon" type="image/png" href="/assets/vinbot-logo.png" />

  <!-- Forside-specifik finpudsning: kort, sektioner, spacing -->
  <style>
    /* Stop u√∏nsket horisontal scroll p√• mobil ift. udvalgte sektioner */
    .wrap { overflow-x: hidden; }

    /* === FORSIDE-SEKTIONER & SPACING === */

    /* Hero lidt luft nedad */
    .hero {
      padding-bottom: 40px;
    }

    /* Alle tre hovedsektioner p√• forsiden */
    .front-section {
      padding-top: 40px;   /* ens afstand op til hvert sektionstitel */
    }

    /* Nulstil margin-top/-bottom fra global CSS (s√• vi har fuld kontrol) */
    .home-shortcuts,
    #featured-stores,
    #featured-wines {
      margin-top: 0 !important;
      margin-bottom: 0 !important;
      padding-bottom: 0;
    }

    /* Indre featured-blok i #featured-wines m√• ikke give ekstra afstand */
    #featured-wines .featured {
      margin-top: 0;
    }

    /* Sektionstitler ‚Äì ens spacing under overskrifterne */
    .home-shortcuts-title,
    .featured-title {
      margin-top: 0;
      margin-bottom: 16px;
    }

    /* === FEATURED SEKTIONER (BUTIKKER + VINE) === */

    .featured {
      margin: 0 auto 30px; /* 0 top, lidt luft i bunden */
    }

    .featured-title {
      text-align: center;
      font-size: 20px;
    }

    .featured-grid {
      display: grid;
      gap: 14px;
      grid-template-columns: repeat(3, minmax(0, 1fr));
    }

    @media (max-width:900px){
      .featured-grid { grid-template-columns: repeat(2,1fr); }
    }
    @media (max-width:560px){
      .featured-grid { grid-template-columns: 1fr; }
    }

    .featured-card {
      display: flex;
      align-items: center;
      gap: 12px;
      text-decoration: none;
      color: inherit;
      padding: 12px;
      border: 1px solid var(--border);
      border-radius: 16px;
      background: linear-gradient(180deg,var(--card),var(--card-2));
      transition: transform .12s,border-color .12s,box-shadow .12s;
    }
    .featured-card:hover {
      transform: translateY(-2px);
      border-color: rgba(255,255,255,.28);
      box-shadow: 0 10px 24px rgba(0,0,0,.4);
    }

    .featured-logo {
      width: 88px;
      height: 88px;
      border-radius: 999px;
      overflow: hidden;
      background: #fff;
      flex: 0 0 88px;
    }
    .featured-logo img {
      width: 88px;
      height: 88px;
      object-fit: cover;
      display: block; /* bevidst crop */
    }

    .featured-body h3 {
      margin: 0 0 4px;
      font-size: 16px;
    }
    .featured-body p {
      margin: 0;
      color: var(--text-dim);
      font-size: 14px;
    }

    /* S√∏rg for at featured-wines billeder aldrig spr√¶nger layout */
    #featured-wines img { max-width: 100%; height: auto; display:block; }

    /* Sm√• tekster til smagsnote og madmatch */
    .card-small {
      font-size: 13px;
      margin: 4px 0 0;
      line-height: 1.35;
    }
    .card-small.dim {
      color: var(--text-dim);
    }

    /* Zoom-effekt KUN p√• udvalgte vine p√• forsiden */
    .card--featured .card-media {
      position: relative;
      overflow: visible; /* billedet m√• godt stikke udenfor kortet */
    }
    .card--featured .card-media img {
      transition: transform .18s ease-out, box-shadow .18s ease-out;
      transform-origin: center bottom;
    }
    .card--featured:hover .card-media img {
      transform: scale(1.7);
      box-shadow: 0 18px 40px rgba(0,0,0,.7);
    }

    /* Home shortcuts (popul√¶re s√∏gninger) ‚Äì layout */
    .home-shortcuts {
      max-width: 1100px;
      margin: 0 auto;
      padding: 0 20px;
    }
    .home-shortcuts-title {
      text-align: center;
      font-size: 20px;
    }
    .home-shortcuts-sub {
      text-align: center;
      margin: 0 0 18px;
      color: var(--text-dim);
      font-size: 14px;
    }
    .home-shortcuts-grid {
      display: grid;
      gap: 12px;
      grid-template-columns: repeat(3,minmax(0,1fr));
    }
    @media (max-width:900px){
      .home-shortcuts-grid { grid-template-columns: repeat(2,minmax(0,1fr)); }
    }
    @media (max-width:600px){
      .home-shortcuts-grid { grid-template-columns: 1fr; }
    }

    .home-shortcut-card {
      text-decoration: none;
      color: inherit;
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: linear-gradient(180deg,var(--card),var(--card-2));
      display: flex;
      flex-direction: column;
      gap: 4px;
      transition: transform .12s, box-shadow .12s, border-color .12s;
    }
    .home-shortcut-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 24px rgba(0,0,0,.4);
      border-color: rgba(255,255,255,.32);
    }
    .home-shortcut-card h3 {
      margin: 0;
      font-size: 15px;
    }
    .home-shortcut-card p {
      margin: 0;
      font-size: 13px;
      color: var(--text-dim);
    }
  </style>
</head>
<body>
  <!-- Header partial mount -->
  <div id="header"></div>

  <header class="hero">
    <h1>Find vin p√• sekunder</h1>
    <p>Fort√¶l hvad du er i hum√∏r til ‚Äì <strong>drue</strong>, <strong>mad</strong>, <strong>pris</strong> eller <strong>lejlighed</strong>. Vinbot guider dig til de bedste flasker og butikker.</p>

    <div class="search-wrap">
      <!-- FORM s√• Enter fungerer p√• mobil/desktop -->
      <form class="search" id="searchForm" novalidate>
        <div class="icon">üîé</div>
        <input id="q" placeholder="Fx ‚ÄúBarolo til b√∏f under 150 kr‚Äù eller ‚ÄúOst og hygge‚Äù" autocomplete="off" />
        <button class="btn-primary" id="searchBtn" type="submit">S√∏g</button>
      </form>
      <p class="search-hint">Tryk <kbd>Enter</kbd> eller brug mobilens ‚ÄúS√∏g‚Äù</p>
    </div>
  </header>

  <!-- STATUS + AI-OPF√òLGNING LIGE UNDER S√òGNING -->
  <div id="status" class="status"></div>
  <section id="followup" class="followup hidden" aria-live="polite"></section>

  <!-- SEKTION 1: Popul√¶re s√∏gninger / genveje -->
  <section class="home-shortcuts wrap front-section" aria-labelledby="sec-home-shortcuts">
    <h2 id="sec-home-shortcuts" class="home-shortcuts-title">‚ú® Popul√¶re s√∏gninger og temaer</h2>
    <p class="home-shortcuts-sub">
      Klik p√• en genvej og kom direkte til guides og anbefalinger ‚Äì eller brug s√∏gefeltet ovenfor.
    </p>
    <div class="home-shortcuts-grid">
      <!-- r√¶kke 1 -->
      <a class="home-shortcut-card" href="/pages/vin-til/juleaften.html">
        <h3>üéÑ Vin til juleaften</h3>
        <p>Vin til and, fl√¶skesteg og hele julemenuen.</p>
      </a>
      <a class="home-shortcut-card" href="/pages/vin-til/nytarsaften.html">
        <h3>ü•Ç Vin til nyt√•rsaften</h3>
        <p>Bobler og vin til nyt√•rsmenu og kransekage.</p>
      </a>
      <a class="home-shortcut-card" href="/pages/vin-til/tapas.html">
        <h3>üßÄ Vin til tapas</h3>
        <p>R√∏dvin, hvidvin og bobler til sm√• retter og hygge.</p>
      </a>

      <!-- r√¶kke 2 -->
      <a class="home-shortcut-card" href="/pages/anbefalinger/under-100.html">
        <h3>üí∏ God vin under 100 kr</h3>
        <p>Hverdagsvenlige flasker n√•r budgettet er vigtigt.</p>
      </a>
      <a class="home-shortcut-card" href="/pages/anbefalinger/hverdagsvin.html">
        <h3>üç∑ Hverdagsvin</h3>
        <p>Nemme, sikre flasker til helt almindelige aftener.</p>
      </a>
      <a class="home-shortcut-card" href="/pages/druer/">
        <h3>üçá L√¶r druerne at kende</h3>
        <p>Fra Cabernet til Riesling ‚Äì drueguides samlet √©t sted.</p>
      </a>

      <!-- r√¶kke 3 -->
      <a class="home-shortcut-card" href="/pages/vin-til/ostebord.html">
        <h3>üßà Vin til ostebord</h3>
        <p>Vin til faste oste, bl√•skimmel og bl√∏de oste.</p>
      </a>
      <a class="home-shortcut-card" href="/pages/blog/hvad-betyder-naturvin.html">
        <h3>üåø Hvad betyder naturvin?</h3>
        <p>Bliv klog p√• naturvin og hvorn√•r det giver mening.</p>
      </a>
      <a class="home-shortcut-card" href="/pages/blog/guide-til-vintemperaturer.html">
        <h3>üå°Ô∏è Guide til vintemperatur</h3>
        <p>Server r√∏dvin, hvidvin og bobler ved den rigtige temperatur.</p>
      </a>
    </div>
  </section>

  <!-- SEKTION 2: Udvalgte butikker -->
  <section id="featured-stores" class="featured wrap front-section" aria-labelledby="sec-featured-stores">
    <h2 id="sec-featured-stores" class="featured-title">üè™ Udvalgte butikker</h2>
    <div class="featured-grid">
      <!-- R√¶kke 1 -->
      <a class="featured-card outbound"
         href="https://www.partner-ads.com/dk/klikbanner.php?partnerid=50537&bannerid=68720"
         target="_blank" rel="nofollow sponsored noopener"
         data-label="Udvalgt butik ¬∑ Den Sidste Flaske">
        <div class="featured-logo">
          <img src="/assets/partners/den-sidste-flaske.png" alt="Den Sidste Flaske logo" loading="lazy">
        </div>
        <div class="featured-body">
          <h3>Den Sidste Flaske</h3>
          <p>Anbefalet partner</p>
        </div>
      </a>

      <a class="featured-card outbound"
         href="https://www.partner-ads.com/dk/klikbanner.php?partnerid=50537&bannerid=108257"
         target="_blank" rel="nofollow sponsored noopener"
         data-label="Udvalgt butik ¬∑ DH Wines">
        <div class="featured-logo">
          <img src="/assets/partners/dh-wines.png" alt="DH Wines logo" loading="lazy">
        </div>
        <div class="featured-body">
          <h3>DH Wines</h3>
          <p>Kvalitetsudvalg</p>
        </div>
      </a>

      <a class="featured-card outbound"
         href="https://www.partner-ads.com/dk/klikbanner.php?partnerid=50537&bannerid=92995"
         target="_blank" rel="nofollow sponsored noopener"
         data-label="Udvalgt butik ¬∑ D‚ÄôWine">
        <div class="featured-logo">
          <img src="/assets/partners/dwine.png" alt="D‚ÄôWine logo" loading="lazy">
        </div>
        <div class="featured-body">
          <h3>D‚ÄôWine</h3>
          <p>Udvalgt butik</p>
        </div>
      </a>

      <!-- R√¶kke 2 -->
      <a class="featured-card outbound"
         href="https://www.partner-ads.com/dk/klikbanner.php?partnerid=50537&bannerid=71309"
         target="_blank" rel="nofollow sponsored noopener"
         data-label="Udvalgt butik ¬∑ Johnsen Wine">
        <div class="featured-logo">
          <img src="/assets/partners/johnsen.png" alt="Johnsen Wine logo" loading="lazy">
        </div>
        <div class="featured-body">
          <h3>Johnsen Wine</h3>
          <p>H√•ndplukkede vine</p>
        </div>
      </a>

      <a class="featured-card outbound"
         href="https://www.partner-ads.com/dk/klikbanner.php?partnerid=50537&bannerid=87612"
         target="_blank" rel="nofollow sponsored noopener"
         data-label="Udvalgt butik ¬∑ Mere om Vin">
        <div class="featured-logo">
          <img src="/assets/partners/meromvin.png" alt="Mere om Vin logo" loading="lazy">
        </div>
        <div class="featured-body">
          <h3>Mere Om Vin</h3>
          <p>Historier & flasker</p>
        </div>
      </a>

      <a class="featured-card outbound"
         href="https://www.partner-ads.com/dk/klikbanner.php?partnerid=50537&bannerid=76709"
         target="_blank" rel="nofollow sponsored noopener"
         data-label="Udvalgt butik ¬∑ Winther Vin">
        <div class="featured-logo">
          <img src="/assets/partners/winthervin.png" alt="Winther Vin logo" loading="lazy">
        </div>
        <div class="featured-body">
          <h3>Winther Vin</h3>
          <p>Sm√• producenter</p>
        </div>
      </a>
    </div>
  </section>

  <!-- SEKTION 3: Udvalgte vine -->
  <section class="wrap front-section" id="featured-wines"></section>

  <main class="wrap">
    <!-- Sortering -->
    <div id="sortbar" class="sortbar" style="display:none;">
      <label for="sortSel">Sort√©r: </label>
      <select id="sortSel">
        <option value="relevance">Mest relevant</option>
        <option value="price_asc">Laveste pris</option>
        <option value="price_desc">H√∏jeste pris</option>
      </select>
    </div>

    <!-- Resultater -->
    <section id="results" aria-live="polite"></section>

    <!-- Vis flere (start skjult!) -->
    <div id="moreWrap" class="load-more" style="display:none;">
      <button id="moreBtn" class="btn-primary">Vis flere</button>
    </div>

    <!-- Partnere uden feeds (fallback) -->
    <section id="alsoStores" class="also-stores" style="display:none;"></section>
  </main>

  <!-- Footer partial mount -->
  <div id="footer"></div>

  <!-- Udvalgte vine lige nu (DATA + FUNKTION) -->
  <script>
    const FEATURED_WINES = [
      {
        title: "Primitivo Susumaniello Salento Boccantino 2024",
        blurb: "Den mest elskede r√∏dvin i Danmark ‚Äì og med god grund.",
        priceText: "55,- ved k√∏b af min. 12 flasker",
        href: "https://www.partner-ads.com/dk/klikbanner.php?partnerid=50537&bannerid=68720&htmlurl=https://densidsteflaske.dk/products/primitivo-susumaniello-salento-boccantino-2024",
        image: "/assets/partners/products/primitivo.png",
        merchant: "Den Sidste Flaske"
      },
      {
        title: "The Guv'nor Tinto",
        blurb: "Fyldig, bl√∏d og fuld af m√∏rke b√¶r og krydderier.",
        priceText: "55,- ved k√∏b af min. 12 flasker",
        href: "https://www.partner-ads.com/dk/klikbanner.php?partnerid=50537&bannerid=68720&htmlurl=https://densidsteflaske.dk/products/the-guv-nor-tinto",
        image: "/assets/partners/products/theguvnor.png",
        merchant: "Den Sidste Flaske"
      },
      {
        title: "Weinhof 519 Alte Reben Rheingau Riesling Trocken 2024",
        blurb: "Frisk Riesling med citrus og gr√∏nne √¶bler.",
        priceText: "55,- ved k√∏b af min. 12 flasker",
        href: "https://www.partner-ads.com/dk/klikbanner.php?partnerid=50537&bannerid=68720&htmlurl=https://densidsteflaske.dk/products/alte-reben-riesling-trocken-2022",
        image: "/assets/partners/products/altereben.png",
        merchant: "Den Sidste Flaske"
      }
    ];

    function renderFeaturedWines(){
      const host = document.getElementById("featured-wines");
      if (!host || !FEATURED_WINES.length) return;
      host.innerHTML = `
        <section class="featured">
          <h2 class="featured-title">üç∑ Udvalgte vine lige nu</h2>
          <div class="grid">
            ${FEATURED_WINES.map(w => `
              <a class="card product card--featured outbound" href="${w.href}" target="_blank" rel="nofollow sponsored noopener" data-label="Featured wine: ${w.title}">
                <div class="card-media">
                  ${w.image ? `<img src="${w.image}" alt="${w.title}" loading="lazy">` : `<div class="img-fallback">üç∑</div>`}
                </div>
                <div class="card-body">
                  <h3>${w.title}</h3>
                  <div class="badges">
                    ${w.priceText ? `<span class="badge">${w.priceText}</span>` : ``}
                    ${w.merchant ? `<span class="badge">${w.merchant}</span>` : ``}
                  </div>
                  ${w.blurb ? `<p class="card-text" style="margin:.4rem 0 0;color:var(--text-dim);font-size:14px;line-height:1.4">${w.blurb}</p>` : ``}
                </div>
              </a>
            `).join("")}
          </div>
        </section>
      `;
    }
  </script>

  <!-- Partials + kald af renderFeaturedWines -->
  <script>
  (async()=> {
    const [h,f] = await Promise.all([
      fetch("/partials/header.html",{cache:"no-store"}).then(r=>r.text()),
      fetch("/partials/footer.html",{cache:"no-store"}).then(r=>r.text()),
    ]);
    document.getElementById("header").innerHTML = h;
    document.getElementById("footer").innerHTML = f;
    renderFeaturedWines();

    // ‚Üê NYT: load side-bannere √©n gang globalt
    try {
      if (!window.__sideBannersLoaded) {
        const s = document.createElement("script");
        s.src = "/assets/side-banners.js";
        s.defer = true;
        document.head.appendChild(s);
        window.__sideBannersLoaded = true;
      }
    } catch(e) {}
  })();
</script>


  <!-- Partnere uden feed (favicon-fallback, ingen kommissionsvisning) -->
  <script>
    const PARTNERS_NO_FEED = [
      {
        name:"Den Sidste Flaske",
        baseUrl:"https://densidsteflaske.dk/",
        searchUrl:"https://densidsteflaske.dk/search?q={Q}",
        affiliateTemplate:"https://www.partner-ads.com/dk/klikbanner.php?partnerid=50537&bannerid=68720&htmlurl={URL}",
        logo:"/assets/partners/den-sidste-flaske.png"
      },
      {
        name:"Barlife",
        baseUrl:"https://www.barlife.dk/",
        searchUrl:"https://www.barlife.dk/search/{Q}",
        affiliateTemplate:"https://www.partner-ads.com/dk/klikbanner.php?partnerid=50537&bannerid=25810&htmlurl={URL}",
        logo:"/assets/partners/barlife.png"
      },
      {
        name:"Beer Me",
        baseUrl:"https://www.beer-me.dk/",
        searchUrl:"https://www.beer-me.dk/search/vin",
        affiliateTemplate:"https://www.partner-ads.com/dk/klikbanner.php?partnerid=50537&bannerid=74640&htmlurl={URL}",
        logo:"/assets/partners/beerme.png"
      },
      {
        name:"DH Wines",
        baseUrl:"https://dhwines.dk/",
        searchUrl:"https://dhwines.dk/search?q={Q}&options%5Bprefix%5D=last",
        affiliateTemplate:"https://www.partner-ads.com/dk/klikbanner.php?partnerid=50537&bannerid=108257&htmlurl={URL}",
        logo:"/assets/partners/dh-wines.png"
      },
      {
        name:"Herslev Bryghus",
        baseUrl:"https://herslevbryghus.dk/",
        searchUrl:"https://herslevbryghus.dk/search?q={Q}&options%5Bprefix%5D=last",
        affiliateTemplate:"https://www.partner-ads.com/dk/klikbanner.php?partnerid=50537&bannerid=114001&htmlurl={URL}",
        logo:"/assets/partners/herslev-bryghus.png"
      },
      {
        name:"Fantombryg",
        baseUrl:"https://fantombryg.dk/",
        searchUrl:"https://fantombryg.dk/search?q={Q}&type=product%2Carticle%2Cpage%2Ccollection&options%5Bprefix%5D=last",
        affiliateTemplate:"https://www.partner-ads.com/dk/klikbanner.php?partnerid=50537&bannerid=113985&htmlurl={URL}",
        logo:"/assets/partners/fantombryg.png"
      },
      {
        name:"Johnsen Wine",
        baseUrl:"https://www.johnsenwine.dk/",
        searchUrl:"https://www.johnsenwine.dk/?s={Q}&post_type=product&dgwt_wcas=1",
        affiliateTemplate:"https://www.partner-ads.com/dk/klikbanner.php?partnerid=50537&bannerid=71309&htmlurl={URL}",
        logo:"/assets/partners/johnsen.png"
      },
      {
        name:"D‚ÄôWine",
        baseUrl:"https://d-wine.dk/",
        searchUrl:"https://d-wine.dk/?s={Q}&post_type=page%2Cproduct",
        affiliateTemplate:"https://www.partner-ads.com/dk/klikbanner.php?partnerid=50537&bannerid=92995&htmlurl={URL}",
        logo:"/assets/partners/dwine.png"
      }
    ];

    function partnerLogo(p){
      if (p.logo) return p.logo;
      try{
        const u = new URL(p.baseUrl);
        return `${u.origin}/favicon.ico`;
      }catch{
        return null;
      }
    }

    function buildPartnerSearchUrl(p, query){
      const q = encodeURIComponent(query && query.trim() ? query.trim() : "vin");
      const search = (p.searchUrl || p.baseUrl).replace("{Q}", q);
      if (p.affiliateTemplate) return p.affiliateTemplate.replace("{URL}", encodeURIComponent(search));
      return search;
    }

    function renderAlsoStores(query){
      const $wrap = document.getElementById("alsoStores");
      if (!$wrap) return;

      const q = query && query.trim() ? query.trim() : "vin";
      const sorted = [...PARTNERS_NO_FEED];

      const html = `
        <h2 class="also-title">Se ogs√• hos</h2>
        <div class="store-grid">
          ${sorted.slice(0,8).map(p=>{
            const href = buildPartnerSearchUrl(p, q);
            const logoSrc = partnerLogo(p);
            return `
              <a class="store-card outbound" href="${href}" target="_blank" rel="nofollow sponsored noopener" data-label="Store: ${p.name} ¬∑ ${q}">
                <div class="store-logo">
                  ${logoSrc ? `<img src="${logoSrc}" alt="${p.name} logo" loading="lazy" onerror="this.style.display='none';this.parentElement.classList.add('noimg')">` : ``}
                  <span class="store-fallback">${(p.name||'?').charAt(0)}</span>
                </div>
                <div class="store-body">
                  <h3>${p.name}</h3>
                  <div class="badges">
                    <span class="badge">S√∏g: ‚Äú${q}‚Äù</span>
                    <span class="badge">${p.affiliateTemplate ? "Annoncelink" : "Partner"}</span>
                  </div>
                </div>
              </a>
            `;
          }).join("")}
        </div>
      `;
      $wrap.innerHTML = html;
      $wrap.style.display = "block";
    }
  </script>

  <!-- S√∏gning + AI-opf√∏lgning -->
  <script>
    /* -------- INTENT & SYNONYMER -------- */
    const INTENT = {
      ost:["portvin","riesling","chardonnay","sauternes"],
      pizza:["chianti","barbera","primitivo"],
      b√∏f:["barolo","cabernet sauvignon","syrah"],
      oksek√∏d:["cabernet","syrah","malbec"],
      lam:["syrah","rioja","ribera del duero"],
      fisk:["riesling","chablis","albari√±o"],
      sushi:["riesling","sauvignon blanc","cr√©mant"],
      tapas:["rioja","garnacha","cava"],
      dessert:["sauternes","portvin","moscato"],
      sommer:["ros√©","sauvignon blanc","cr√©mant"],
      terrasse:["ros√©","cava","prosecco"],
      hygge:["primitivo","zinfandel","malbec"],
      romantisk:["pinot noir","champagne"]
    };
    const EQUIV = {
      barolo:["nebbiolo"], nebbiolo:["barolo"],
      rioja:["tempranillo"], tempranillo:["rioja"],
      ribera:["ribera del duero","tempranillo"], "ribera del duero":["ribera","tempranillo"],
      shiraz:["syrah"], syrah:["shiraz"],
      rose:["ros√©"], "ros√©":["rose"],
      cab:["cabernet","cabernet sauvignon"], cabernet:["cab","cabernet sauvignon"], "cabernet sauvignon":["cab","cabernet"]
    };

    /* -------- STATE -------- */
    const state = {
      baseTerms: [],
      filters: { farve:null, stil:[], pris:null, land:[], anledning:null, mad:null },
      products: [],
      picks: [],
      visible: 0,
      pageSize: 12,
      sortBy: "relevance",
      lastQueryText: ""
    };

    const CHIP_MAP = {
      farve: {
        "r√∏d":["barolo","nebbiolo","cabernet","syrah","malbec","tempranillo","zinfandel","primitivo","pinot noir"],
        "hvid":["chardonnay","riesling","sauvignon blanc","chablis","albari√±o","arneis"],
        "ros√©":["ros√©","provencalsk ros√©"],
        "bobler":["champagne","cr√©mant","cava","prosecco"]
      },
      stil: {
        "let":["pinot noir","gamay","bardolino","valpolicella"],
        "frugtig":["primitivo","zinfandel","malbec"],
        "kraftig":["barolo","amarone","cabernet sauvignon","syrah"],
        "t√∏r":["riesling trocken","chablis","albari√±o","fiano"],
        "s√∏d":["sauternes","moscato","portvin"]
      },
      land: {
        "italien":["barolo","chianti","amarone","prosecco","arneis"],
        "frankrig":["bourgogne","chablis","c√¥tes du rh√¥ne","cr√©mant","champagne"],
        "spanien":["rioja","ribera del duero","albari√±o","cava"],
        "tyskland":["riesling","sp√§tburgunder"],
        "portugal":["portvin","vinho verde"]
      },
      anledning: {
        "sommer":["ros√©","sauvignon blanc","cr√©mant"],
        "hygge":["primitivo","zinfandel","malbec"],
        "romantisk":["pinot noir","champagne"],
        "fest":["cava","prosecco","cr√©mant"]
      }
    };

    function normalize(s = "") {
      return s
        .toLowerCase()
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g,"")
        .replace(/\s+/g," ")
        .trim();
    }

    // ‚¨áÔ∏è OPDATERET: fanger nu "under 100", "under 100,-", "under 100 kr", "max 150" osv.
    function deriveTermsFromInput(raw){
      const q = normalize(raw||"");
      const S = new Set();

      // intent (julemad, b√∏f osv.)
      Object.keys(INTENT).forEach(k => {
        if (q.includes(k)) INTENT[k].forEach(v => S.add(v));
      });

      // almindelige ord + synonymer
      q.split(/\s+/).forEach(t => {
        if (!t) return;
        S.add(t);
        (EQUIV[t] || []).forEach(x => S.add(x));
      });

      // pris: under 100 / max 150 / under 100 kr / under 100,-
      let max = null;
      const m = q.match(/(?:under|max)\s*(\d{2,4})(?:\s*(?:kr\.?|dkk|,-))?/);
      if (m) max = parseInt(m[1], 10);

      // "billig/budget" ‚Üí max 100 hvis ikke andet
      if (/billig|budget/.test(q)) {
        max = Math.min(max ?? 9999, 100);
      }

      return { terms:[...S], max };
    }

    function deriveTermsFromFilters(){
      const f = state.filters;
      const extra = new Set();
      if (f.farve && CHIP_MAP.farve[f.farve]) CHIP_MAP.farve[f.farve].forEach(t=>extra.add(t));
      f.stil.forEach(s => (CHIP_MAP.stil[s]||[]).forEach(t=>extra.add(t)));
      f.land.forEach(l => (CHIP_MAP.land[l]||[]).forEach(t=>extra.add(t)));
      if (f.anledning && CHIP_MAP.anledning[f.anledning]) CHIP_MAP.anledning[f.anledning].forEach(t=>extra.add(t));
      if (f.mad && INTENT[f.mad]) INTENT[f.mad].forEach(t=>extra.add(t));
      [...extra].forEach(t => (EQUIV[t]||[]).forEach(x=>extra.add(x)));
      return [...extra];
    }

    function generateTastingNote(p) {
      const t = (p.title || "").toLowerCase();
      const notes = [];

      if (t.includes("pinot")) notes.push("Let og elegant r√∏dvin med r√∏de b√¶r og bl√∏de tanniner.");
      if (t.includes("nebbiolo") || t.includes("barolo")) notes.push("Stram tannin, r√∏de frugter og let krydret finish.");
      if (t.includes("primitivo") || t.includes("zinfandel")) notes.push("Fyldig, varm og frugtig med modne m√∏rke b√¶r.");
      if (t.includes("cabernet")) notes.push("Kraftig vin med solb√¶r, eg og markerede tanniner.");
      if (t.includes("malbec")) notes.push("M√∏rk, saftig og bl√∏d med blomme og m√∏rke b√¶r.");
      if (t.includes("riesling")) notes.push("Frisk og aromatisk med citrus og gr√∏nne √¶bler.");
      if (t.includes("chardonnay")) notes.push("Fyldig hvidvin med sm√∏r, vanilje og moden frugt.");
      if (t.includes("sauvignon")) notes.push("Spr√∏d, frisk og aromatisk med stikkelsb√¶r og lime.");
      if (t.includes("ros√©")) notes.push("Let og frisk ros√© med noter af jordb√¶r og hindb√¶r.");

      if (!notes.length) notes.push("Balanceret vin med frugt, syre og god struktur.");
      return notes[0];
    }

    function generateFoodMatch(p) {
      const t = (p.title || "").toLowerCase();

      if (t.includes("pinot")) return "Perfekt til and, svampe og lyst k√∏d.";
      if (t.includes("nebbiolo") || t.includes("barolo")) return "God til b√∏f, oksek√∏d og vildt.";
      if (t.includes("primitivo") || t.includes("zinfandel")) return "Matcher pizza, grill og krydrede retter.";
      if (t.includes("cabernet") || t.includes("malbec")) return "Ideel til r√∏dt k√∏d, grill og kraftige retter.";
      if (t.includes("riesling")) return "Super til fisk, asiatisk og let krydret mad.";
      if (t.includes("chardonnay")) return "Matcher kylling, retter med fl√∏de og fisk.";
      if (t.includes("sauvignon")) return "God til salater, fisk og gr√∏nt.";
      if (t.includes("ros√©")) return "Perfekt p√• terrassen og til let sommermad.";
      if (t.includes("cava") || t.includes("champagne")) return "Perfekt til tapas, snacks og forretter.";

      return "Matcher et bredt udvalg af retter.";
    }

    function isWineProduct(p){
      const t = ((p.title || "") + " " + (p.category || "") + " " + (p.brand || "")).toLowerCase();

      const strongWineWords = [
        "r√∏dvin","hvidvin","ros√©","rose",
        "champagne","cava","prosecco","cr√©mant",
        "riesling","pinot","nebbiolo","barolo",
        "bordeaux","bourgogne","chianti","amarone",
        "zinfandel","malbec","sauvignon","chardonnay",
        "primitivo","rioja","ribera del duero",
        "portvin","sherry","vinho verde","sp√§tburgunder",
        "tempranillo"
      ];

      const weakWineWords = [" vin ", "vin ", " vin"];

      const accessoryWords = [
        "glas","vinglas","drikkeglas","shotglas","√∏lglas",
        "glasflaske","flaske med svingl√•g","karaffel","karafel",
        "dekanter","decanter","proptr√¶kker","oplukker","√•bner",
        "foliesk√¶rer","foliekniv","vinreol","vinholder","vink√∏ler",
        "vinkasse","gave√¶ske","smagekasse","smagepakke","pakke",
        "gavekort","abonnement","magnet","plakat","bog",
        "kosteskaft","kosteskaftet","kost","kop","krus","kande",
        "greencups","cup","suger√∏r","serviet"
      ];

      const hasStrong = strongWineWords.some(w => t.includes(w));
      const hasWeak   = weakWineWords.some(w => t.includes(w));
      const hasAcc    = accessoryWords.some(w => t.includes(w));

      if (hasAcc && !hasStrong) return false;
      if (hasStrong) return true;
      if (hasWeak && !hasAcc) return true;
      return false;
    }

    function priceHTML(p){
      const old = p.price_old ?? p.glpris ?? p.compareAt ?? p.saleprice_old ?? null;
      const curr = (p.price != null)
        ? Number(p.price).toLocaleString("da-DK",{style:"currency",currency:"DKK"})
        : null;

      if (old && p.price && Number(old) > Number(p.price)) {
        const oldF = Number(old).toLocaleString("da-DK",{style:"currency",currency:"DKK"});
        return `<span class="price price-sale">${curr}</span><span class="price price-old">${oldF}</span>`;
      }
      return curr ? `<span class="price">${curr}</span>` : "";
    }

    function badgesHTML(p){
      const b = [];
      if (state.filters.pris) b.push(`Budget ‚â§ ${state.filters.pris} kr`);
      if (state.filters.farve) b.push(state.filters.farve);
      if (state.filters.stil && state.filters.stil.length) b.push(...state.filters.stil);
      if (state.filters.land && state.filters.land.length) b.push(...state.filters.land);
      if (state.filters.anledning) b.push(state.filters.anledning);
      if (state.filters.mad) b.push(`Til ${state.filters.mad}`);
      const hasOld = p.price_old ?? p.glpris ?? p.compareAt ?? null;
      if (hasOld && p.price && Number(hasOld) > Number(p.price)) b.push("Tilbud");
      const m = p.merchant ? [p.merchant] : [];
      return `<div class="badges">
        ${priceHTML(p)}
        ${m.concat(b).map(t=>`<span class="badge ${t==='Tilbud'?'badge--sale':''}">${t}</span>`).join("")}
      </div>`;
    }

    function cardHTML(p){
      const note = generateTastingNote(p);
      const food = generateFoodMatch(p);

      return `
        <a class="card product outbound" href="${p.url}" target="_blank" rel="nofollow sponsored noopener" data-label="${p.title}">
          <div class="card-media">
            ${p.image ? `<img src="${p.image}" alt="${p.title}">` : `<div class="img-fallback">üç∑</div>`}
          </div>
          <div class="card-body">
            <h3>${p.title}</h3>
            ${badgesHTML(p)}
            <p class="card-small">${note}</p>
            <p class="card-small dim">Madmatch: ${food}</p>
          </div>
        </a>
      `;
    }

    function pickTop3(items, terms){
      const W = { rel:5, img:2, pricedist:2, comm:1, norm:1, diversity:2 };
      const COMM = { "Mere om Vin": 0.10, "Winther Vin": 0.10, "Vinea": 0.10, "SPS Wine": 0.15 };
      const budget = state.filters.pris ?? null;

      function relScore(p){
        let s=0; const hay=((p.title||"")+" "+(p.brand||"")).toLowerCase();
        terms.forEach(t=>{ if(hay.includes(t)) s+=1; });
        return s*W.rel + (p.image?W.img:0);
      }
      function priceScore(p){
        if (p.price==null || !budget) return 0;
        const d = Math.abs(p.price - budget);
        const pct = Math.min(1, d / Math.max(1,budget));
        return (1 - pct) * W.pricedist;
      }
      function commScore(p){ return (COMM[p.merchant] ?? 0) * 10 * W.comm; }
      function normScore(p){
        if (/(\bmagnum\b|\bjeroboam\b|\b6 ?l\b|\bkasse\b|\bsmagekasse\b|\bpack\b)/i.test(p.title||"")) return -2*W.norm;
        if (p.price!=null && p.price > 5000 && !/\bmagnum|kasse|samling|√•rgang\b/i.test(p.title||"")) return -2*W.norm;
        return 0;
      }
      function baseScore(p){ return relScore(p) + priceScore(p) + commScore(p) + normScore(p); }
      function overlap(a,b){
        const A=new Set((a.title||"").toLowerCase().split(/\W+/));
        const B=new Set((b.title||"").toLowerCase().split(/\W+/));
        let inter=0; A.forEach(x=>{ if(B.has(x)) inter++; });
        return inter / Math.max(1, Math.min(A.size,B.size));
      }

      const pool=[...items].sort((a,b)=>baseScore(b)-baseScore(a)).slice(0,50);
      const chosen=[];
      while (chosen.length<3 && pool.length){
        let best=null, bestS=-1e9;
        for (const p of pool){
          const penalty = chosen.length ? Math.max(...chosen.map(c=>overlap(p,c))) : 0;
          const s = baseScore(p) - penalty*W.diversity;
          if (s > bestS){ best=p; bestS=s; }
        }
        if (!best) break;
        chosen.push(best);
        pool.splice(pool.indexOf(best),1);
      }
      return chosen;
    }

    async function doSearch(fromChip=false){
      const q = document.getElementById('q').value.trim();
      state.lastQueryText = q;
      if (!fromChip) state.filters = { farve:null, stil:[], pris:null, land:[], anledning:null, mad:null };

      /* Skjul forsidesektioner MED DET SAMME, s√• status bliver lige under s√∏gefeltet */
      const secShort = document.querySelector('.home-shortcuts');
      const secStoresStart = document.getElementById('featured-stores');
      const secWinesStart  = document.getElementById('featured-wines');
      if (secShort)       secShort.style.display = 'none';
      if (secStoresStart) secStoresStart.style.display = 'none';
      if (secWinesStart)  secWinesStart.style.display  = 'none';

      const base = deriveTermsFromInput(q);
      state.baseTerms = base.terms;
      if (base.max != null) state.filters.pris = base.max;

      const refined = deriveTermsFromFilters();
      const terms = Array.from(new Set([...state.baseTerms, ...refined]));

      const $status = document.getElementById("status");
      const $res = document.getElementById("results");
      $status.innerHTML = `<div class="msg info"><span class="spinner"></span> S√∏ger i butikker‚Ä¶</div>`;
      $res.innerHTML = `<div class="msg info"><span class="spinner"></span> Finder flasker‚Ä¶</div>`;

      const params = new URLSearchParams();
      params.set("q", terms.join(" "));
      if (state.filters.pris != null) params.set("max", String(state.filters.pris));

      const r = await fetch(`/api/search?${params.toString()}`, {cache:"no-store"});
      const data = await r.json();
      const meta = data.meta || {};

      let products = Array.isArray(data.products) ? data.products : [];
      const filtered = products.filter(isWineProduct);
      if (filtered.length >= 4) {
        products = filtered;
      }

      if (data.source === "feed") {
        const bits = [];
        bits.push(`Viser ${products.length ?? 0} flasker`);
        if (meta.feeds_ok != null && meta.feeds_total != null) bits.push(`Fra ${meta.feeds_ok} / ${meta.feeds_total} butikker`);
        if (meta.feeds_failed) bits.push(`(${meta.feeds_failed} fejlede)`);
        $status.innerHTML = `<div class="msg info">${bits.join(" ¬∑ ")}</div>`;
      } else if (data.source === "fallback") {
        $status.innerHTML = `<div class="msg err">Ingen direkte feed-tr√¶f. Viser butikssider uden pris.</div>`;
      } else {
        $status.innerHTML = `<div class="msg err">Ingen resultater.</div>`;
      }

      state.products = products;
      state.sortBy = "relevance";
      state.picks = pickTop3(state.products, terms);
      state.visible = 0;

      document.getElementById("sortbar").style.display = state.products.length ? "block" : "none";
      document.getElementById("sortSel").value = "relevance";
      renderAll();
      renderFollowup(q, state.products.length);
      renderAlsoStores(state.lastQueryText || "vin");

      /* Skjul / vis forsidesektioner alt efter om der ER resultater */
      const hasResults = state.products.length > 0;
      const secShort2  = document.querySelector('.home-shortcuts');
      const secStores  = document.getElementById('featured-stores');
      const secWines   = document.getElementById('featured-wines');
      if (secShort2) secShort2.style.display = hasResults ? 'none' : '';
      if (secStores) secStores.style.display  = hasResults ? 'none' : '';
      if (secWines)  secWines.style.display   = hasResults ? 'none' : '';

      /* Scroll til resultaterne */
      document.getElementById('results')?.scrollIntoView({ behavior:'smooth', block:'start' });
    }

    function sortProducts(list){
      const arr = [...list];
      if (state.sortBy === "price_asc") return arr.sort((a,b)=> (a.price ?? 9e12) - (b.price ?? 9e12));
      if (state.sortBy === "price_desc") return arr.sort((a,b)=> (b.price ?? -1) - (a.price ?? -1));
      return arr;
    }

    function renderAll(){
      const $res = document.getElementById("results");
      const sorted = sortProducts(state.products);

      const topHTML = (state.sortBy === "relevance" && state.picks.length) ? `
        <section class="top-picks">
          <h2>Anbefalet af Vinbot</h2>
          <div class="picks-row">
            ${state.picks.map(p => cardHTML(p)).join("")}
          </div>
        </section>
      ` : "";

      state.visible = Math.min(state.pageSize, sorted.length);
      const listHTML = `
        <section class="grid">
          ${sorted.slice(0, state.visible).map(p => cardHTML(p)).join("")}
        </section>
      `;
      $res.innerHTML = topHTML + listHTML;

      const hasMore = state.visible < sorted.length;
      document.getElementById("moreWrap").style.display = hasMore ? "block" : "none";
    }

    function showMore(){
      const $res = document.getElementById("results");
      const sorted = sortProducts(state.products);
      const next = Math.min(state.visible + state.pageSize, sorted.length);
      if (next <= state.visible) return;
      const grid = $res.querySelector(".grid");
      const slice = sorted.slice(state.visible, next).map(p => cardHTML(p)).join("");
      grid.insertAdjacentHTML("beforeend", slice);
      state.visible = next;
      document.getElementById("moreWrap").style.display = state.visible < sorted.length ? "block" : "none";
    }

    document.getElementById("moreBtn").addEventListener("click", showMore);
    document.getElementById("sortSel").addEventListener("change", (e)=>{
      state.sortBy = e.target.value;
      renderAll();
    });

    function renderFollowup(query, resultCount){
      const $f = document.getElementById("followup");
      const generic = /r√∏dvin|hvidvin|ros[e√©]|bobler|vin|ost|pizza|k√∏d|b√∏f|mad|sommer|hygge/i.test(query);
      const shouldAsk = generic || resultCount < 8;
      if (!shouldAsk) { $f.classList.add("hidden"); $f.innerHTML=""; return; }

      const chips = (group, items, multi=false) => `
        <div class="chip-group" data-group="${group}" data-multi="${multi}">
          <div class="chip-title">${group}</div>
          <div class="chip-row">
            ${items.map(label => `<button class="chip ${isActive(group,label) ? 'on':''}" data-value="${label}">${label}</button>`).join("")}
          </div>
        </div>`;

      const ui = `
        <div class="followup-inner">
          <h2>Hj√¶lp mig med at ramme smagen</h2>
          <div class="chip-grid">
            ${chips("farve", ["r√∏d","hvid","ros√©","bobler"], false)}
            ${chips("stil", ["let","frugtig","kraftig","t√∏r","s√∏d"], true)}
            ${chips("land", ["italien","frankrig","spanien","tyskland","portugal"], true)}
            ${chips("anledning", ["sommer","hygge","romantisk","fest"], false)}
            ${chips("mad", ["ost","pizza","b√∏f","lam","fisk","sushi","tapas","dessert"], false)}
          </div>
          <div class="chip-actions">
            <div class="price-wrap">
              <label for="ai-price">Maks pris</label>
              <input id="ai-price" type="number" min="30" step="10" placeholder="Fx 150" value="${state.filters.pris ?? ''}">
            </div>
            <button id="applyChips" class="btn-primary">Opdater</button>
            <button id="clearChips" class="btn-soft">Nulstil</button>
          </div>
        </div>
      `;
      $f.innerHTML = ui;
      $f.classList.remove("hidden");

      $f.querySelectorAll(".chip").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const group = btn.closest(".chip-group").dataset.group;
          const multi = btn.closest(".chip-group").dataset.multi === "true";
          toggleChip(group, btn.dataset.value, multi);
          btn.classList.toggle("on");
          if (!multi) doSearch(true);
        });
      });
      $f.querySelector("#applyChips").addEventListener("click", ()=>{
        const v = document.getElementById("ai-price").value.trim();
        state.filters.pris = v ? Math.max(0, parseInt(v,10)) : null;
        doSearch(true);
      });
      $f.querySelector("#clearChips").addEventListener("click", ()=>{
        state.filters = { farve:null, stil:[], pris:null, land:[], anledning:null, mad:null };
        doSearch(true);
      });
    }

    function isActive(group, label){
      const f = state.filters;
      if (Array.isArray(f[group])) return f[group].includes(label);
      return f[group] === label;
    }

    function toggleChip(group, label, multi){
      const f = state.filters;
      if (multi) {
        const arr = Array.isArray(f[group]) ? f[group] : [];
        const i = arr.indexOf(label);
        if (i === -1) arr.push(label); else arr.splice(i,1);
        f[group] = arr;
      } else {
        f[group] = (f[group] === label) ? null : label;
      }
    }

    document.addEventListener('click', (e)=>{
      const a = e.target.closest('a.outbound'); if(!a) return;
      try{
        if (typeof gtag === 'function'){
          gtag('event','outbound_click',{
            event_category:'affiliate',
            event_label:a.dataset.label || a.href
          });
        }
      }catch(_){}
    });
  </script>

  <!-- G√∏r doSearch global + bindings til Enter/knap -->
  <script>
    window.doSearch = doSearch;

    (function(){
      function bind(){
        const form = document.getElementById('searchForm');
        const q    = document.getElementById('q');
        const btn  = document.getElementById('searchBtn');
        if(!form || !q) return;

        form.addEventListener('submit', (e)=>{
          e.preventDefault();
          window.doSearch && window.doSearch();
        });
        q.addEventListener('keydown', (e)=>{
          if(e.key === 'Enter'){
            e.preventDefault();
            window.doSearch && window.doSearch();
          }
        });
        btn && btn.addEventListener('click', (e)=>{
          e.preventDefault();
          window.doSearch && window.doSearch();
        });
      }
      if(document.readyState === 'loading'){
        document.addEventListener('DOMContentLoaded', bind);
      } else {
        bind();
      }
    })();
  </script>

  <!-- SEO: Udvalgte vine structured data -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"ItemList",
    "itemListElement":[
      {
        "@type":"ListItem","position":1,
        "item":{
          "@type":"Product",
          "name":"Primitivo Susumaniello Salento Boccantino 2024",
          "image":"https://vinbot.dk/assets/partners/products/primitivo.png",
          "description":"Den mest elskede r√∏dvin i Danmark ‚Äì og med god grund.",
          "brand":{"@type":"Brand","name":"Den Sidste Flaske"},
          "offers":{
            "@type":"Offer",
            "price":"55.00","priceCurrency":"DKK",
            "url":"https://www.partner-ads.com/dk/klikbanner.php?partnerid=50537&bannerid=68720&htmlurl=https://densidsteflaske.dk/products/primitivo-susumaniello-salento-boccantino-2024",
            "availability":"https://schema.org/InStock"
          }
        }
      },
      {
        "@type":"ListItem","position":2,
        "item":{
          "@type":"Product",
          "name":"The Guv'nor Tinto",
          "image":"https://vinbot.dk/assets/partners/products/theguvnor.png",
          "description":"Fyldig, bl√∏d og fuld af m√∏rke b√¶r og krydderier.",
          "brand":{"@type":"Brand","name":"Den Sidste Flaske"},
          "offers":{
            "@type":"Offer",
            "price":"55.00","priceCurrency":"DKK",
            "url":"https://www.partner-ads.com/dk/klikbanner.php?partnerid=50537&bannerid=68720&htmlurl=https://densidsteflaske.dk/products/the-guv-nor-tinto",
            "availability":"https://schema.org/InStock"
          }
        }
      },
      {
        "@type":"ListItem","position":3,
        "item":{
          "@type":"Product",
          "name":"Weinhof 519 Alte Reben Rheingau Riesling Trocken 2024",
          "image":"https://vinbot.dk/assets/partners/products/altereben.png",
          "description":"Frisk citrus og gr√∏nne √¶bler.",
          "brand":{"@type":"Brand","name":"Den Sidste Flaske"},
          "offers":{
            "@type":"Offer",
            "price":"55.00","priceCurrency":"DKK",
            "url":"https://www.partner-ads.com/dk/klikbanner.php?partnerid=50537&bannerid=68720&htmlurl=https://densidsteflaske.dk/products/alte-reben-riesling-trocken-2022",
            "availability":"https://schema.org/InStock"
          }
        }
      }
    ]
  }
  </script>
  <script>
  (function () {
    const params = new URLSearchParams(window.location.search);
    const q = params.get("q");
    if (!q) return; // ingen q = ingen auto-s√∏gning

    function initDeepLinkSearch() {
      const input = document.getElementById("q");
      if (!input || typeof window.doSearch !== "function") {
        // hvis ikke alt er klar endnu, pr√∏v igen om et √∏jeblik
        return setTimeout(initDeepLinkSearch, 80);
      }

      input.value = q;          // udfyld s√∏gefelt
      window.doSearch();        // k√∏r s√∏gning
    }

    // k√∏r n√•r siden er klar
    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", initDeepLinkSearch);
    } else {
      initDeepLinkSearch();
    }
  })();
</script>
</body>
</html>
