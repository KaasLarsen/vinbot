<!doctype html>
<html lang="da">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vinbot â€“ din personlige vinassistent</title>
  <meta name="description" content="Find den perfekte vin pÃ¥ sekunder. SÃ¸g efter drue, land, mad eller humÃ¸r â€“ Vinbot guider dig til de bedste kÃ¸b." />

  <!-- Google Analytics (GA4) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-JB0QD6J59G"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-JB0QD6J59G');
  </script>

  <style>
    :root{
      --bg: #0f0e10;
      --fg: #f4efe9;
      --muted: #cfc7bd;
      --card: rgba(255,255,255,0.07);
      --cardBorder: rgba(255,255,255,0.15);
      --accent: #e63b3b;
      --accent-2: #ff8a4c;
      --glow: 0 10px 30px rgba(230,59,59,0.35);
      --radius-lg: 18px;
      --shadow-sm: 0 1px 2px rgba(0,0,0,.2);
      --shadow-lg: 0 12px 40px rgba(0,0,0,.45);
    }
    *{ box-sizing:border-box }
    html,body{ height:100% }
    body{
      margin:0; color:var(--fg);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Inter, Roboto, Arial, sans-serif;
      background:
        radial-gradient(1200px 500px at 10% -10%, rgba(230,59,59,.25), transparent 60%),
        radial-gradient(1200px 600px at 110% 10%, rgba(255,138,76,.22), transparent 65%),
        linear-gradient(180deg, #121114 0%, #0b0a0c 100%);
    }

    /* header partial */
    .nav{ max-width:1100px; margin:0 auto; padding:24px 28px; display:flex; align-items:center; gap:18px; }
    .brand{ display:flex; align-items:center; gap:14px; text-decoration:none; color:var(--fg); }
    .brand-logo{
      width:76px; height:76px; display:grid; place-items:center;
      padding:8px; border-radius:16px;
      background: rgba(255,255,255,0.16);
      backdrop-filter: blur(6px);
      box-shadow: 0 8px 26px rgba(0,0,0,.45);
    }
    .brand-logo img{ width:100%; height:100%; object-fit:contain; display:block; }
    .brand h1{ margin:0; font-size:28px; letter-spacing:.2px }

    /* hero */
    .hero{ max-width:980px; margin:28px auto 14px; padding:0 20px; text-align:center; }
    .hero h2{ margin:0 0 10px; font-size:clamp(28px,6vw,56px); line-height:1.05; letter-spacing:-.5px; }
    .hero p{ margin:0 auto 22px; max-width:760px; color:var(--muted); font-size:clamp(16px,2.3vw,18px); }

    /* search */
    .search-wrap{ max-width:900px; margin:22px auto 0; padding:12px; border-radius:18px;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid var(--cardBorder); box-shadow: var(--shadow-lg); backdrop-filter: blur(8px);
    }
    .search{ display:flex; align-items:center; gap:12px; background: rgba(0,0,0,.25);
      border-radius:14px; padding:8px 10px; border:1px solid rgba(255,255,255,.08); }
    .search .icon{ opacity:.7; padding-left:8px }
    .search input{ flex:1; border:0; outline:none; background:transparent; color:var(--fg);
      font-size:clamp(16px,2.4vw,20px); padding:12px 2px; }
    .search button{ border:0; padding:12px 16px; cursor:pointer; color:#fff;
      border-radius:12px; background:linear-gradient(135deg,var(--accent),var(--accent-2));
      box-shadow: var(--glow); font-weight:700; transition: transform .12s, box-shadow .12s; }
    .search button:hover{ transform:translateY(-1px); box-shadow:0 12px 26px rgba(230,59,59,.4); }

    /* results */
    .wrap{ max-width:1100px; margin:28px auto 80px; padding:0 20px; }
    .grid{ display:grid; gap:16px; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); }
    .card{ display:block; text-decoration:none; color:inherit; background:var(--card);
      border:1px solid var(--cardBorder); border-radius:18px; padding:16px; box-shadow:var(--shadow-sm);
      transition: transform .12s, box-shadow .12s, border-color .12s; }
    .card:hover{ transform:translateY(-2px); border-color:rgba(255,255,255,.28); box-shadow:var(--shadow-lg); }
    .card h3{ margin:0 0 8px; font-size:18px; letter-spacing:.2px }
    .badges{ display:flex; gap:8px; flex-wrap:wrap }
    .badge{ font-size:12px; color:#f7f2ec; background:rgba(255,255,255,.12); border:1px solid rgba(255,255,255,.16);
      padding:6px 8px; border-radius:999px; }

    /* footer partial */
    footer{ color:#a99f95; text-align:center; padding:30px 20px 60px; font-size:13px; }
    .socials{ display:flex; justify-content:center; gap:12px; margin-top:6px; }
    .fb{ width:18px; height:18px; display:inline-block; }

    /* a11y focus */
    .card:focus-visible, .search input:focus-visible, .search button:focus-visible{ outline:2px solid #fff; outline-offset:3px; }
  </style>
</head>
<body>
  <!-- header partial mount -->
  <div id="header"></div>

  <header class="hero">
    <h2>Find vin pÃ¥ sekunder</h2>
    <p>FortÃ¦l hvad du er i humÃ¸r til â€“ <strong>drue</strong>, <strong>mad</strong>, <strong>pris</strong> eller <strong>lejlighed</strong>. Vinbot guider dig til de bedste butikker.</p>

    <div class="search-wrap">
      <div class="search">
        <div class="icon">ðŸ”Ž</div>
        <input id="q" placeholder="fx â€œbarolo til bÃ¸f under 150 krâ€ eller â€œsushi og sommerâ€" autocomplete="off" autofocus />
        <button id="searchBtn">SÃ¸g</button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <section class="grid" id="results" aria-live="polite"></section>
  </main>

  <!-- footer partial mount -->
  <div id="footer"></div>

  <script>
    // hent header/footer partials
    (async function loadPartials(){
      const [h,f] = await Promise.all([
        fetch("/partials/header.html", {cache:"no-store"}).then(r=>r.text()),
        fetch("/partials/footer.html", {cache:"no-store"}).then(r=>r.text())
      ]);
      document.getElementById("header").innerHTML = h;
      document.getElementById("footer").innerHTML = f;
    })();
  </script>

  <script>
    // ---- KONFIG ----
    const USE_REDIRECT = false;   // sÃ¦t true nÃ¥r /out er klar
    const OUT_BASE = "/out/";
    const MERCHANTS = [
      { name: "Jysk Vin", host: "jyskvin.dk", search: "https://jyskvin.dk/search?q={Q}" },
      { name: "Beer Me",  host: "beerme.dk",  search: "https://beerme.dk/soeg?q={Q}" }
    ];

    // ---- MINI-ORDBÃ˜GER ----
    const MAP = {
      druer: {
        "barolo":"nebbiolo","nebbiolo":"nebbiolo","pinot noir":"pinot noir","pinot":"pinot noir",
        "chianti":"sangiovese","sangiovese":"sangiovese","primitivo":"primitivo",
        "sauvignon blanc":"sauvignon blanc","riesling":"riesling","chardonnay":"chardonnay",
        "syrah":"syrah","shiraz":"syrah","malbec":"malbec","barbera":"barbera","tempranillo":"tempranillo",
        "rioja":"tempranillo","ribera":"tempranillo","albariÃ±o":"albariÃ±o","albarino":"albariÃ±o",
        "crÃ©mant":"crÃ©mant","cremant":"crÃ©mant","rosÃ©":"rosÃ©","rose":"rosÃ©","chablis":"chardonnay"
      },
      mad: {
        "bÃ¸f":["nebbiolo","cabernet","syrah"], "oksekÃ¸d":["cabernet","syrah","barolo"],
        "pizza":["chianti","primitivo","barbera"], "tapas":["rioja","garnacha","cava"],
        "sushi":["riesling","sauvignon blanc","crÃ©mant"], "fisk":["riesling","chablis","albariÃ±o"],
        "lam":["syrah","ribera","chianti"], "ost":["riesling","portvin","chardonnay"]
      }
    };

    // ---- LOGIK ----
    function parseQuery(text){
      const q = (text||"").toLowerCase();
      const out = { druer:new Set(), mad:null, max:null, mood:null, raw:q.trim() };

      Object.keys(MAP.druer).forEach(k => { if (q.includes(k)) out.druer.add(MAP.druer[k]); });
      Object.keys(MAP.mad).forEach(k => { if (q.includes(k)) out.mad = k; });

      const m = q.match(/under\s*(\d+)\s*kr|(\d+)\s*kr/);
      if (m){ const n = parseInt(m[1]||m[2],10); if (!isNaN(n)) out.max = n; }
      if (q.includes("billig") || q.includes("budget")) out.max = Math.min(out.max||9999, 100);

      if (q.includes("sommer") || q.includes("terrasse")) out.mood = "sommer";
      if (q.includes("hygge")) out.mood = "hygge";
      if (q.includes("romantisk")) out.mood = "romantisk";

      if (!out.druer.size && !out.mad && out.raw) out.druer.add(out.raw);
      return out;
    }

    function buildTarget(merchant, keyword){
      const target = merchant.search.includes("{Q}")
        ? merchant.search.replace("{Q}", encodeURIComponent(keyword))
        : merchant.search;
      if (!USE_REDIRECT) return target;
      const u = new URL(OUT_BASE, location.origin);
      u.searchParams.set("to", target);
      u.searchParams.set("subid", "search-"+Date.now());
      return u.toString();
    }

    function createIdeas(text){
      const f = parseQuery(text);
      const keys = [];
      if (f.mad && MAP.mad[f.mad]) keys.push(...MAP.mad[f.mad].slice(0,2));
      if (f.druer.size) keys.push(...Array.from(f.druer).slice(0,2));
      if (!keys.length && f.raw) keys.push(f.raw);

      const ideas = [];
      for (const kw of keys){
        for (const m of MERCHANTS){
          ideas.push({
            title: `${kw} hos ${m.name}`,
            href: buildTarget(m, kw),
            badges: [f.mad?`Mad: ${f.mad}`:null, f.max?`Under ${f.max} kr`:null, f.mood?`${f.mood}`:null].filter(Boolean)
          });
        }
      }
      return ideas.slice(0, 9);
    }

    // ---- RENDER ----
    const $q = document.getElementById('q');
    const $btn = document.getElementById('searchBtn');
    const $res = document.getElementById('results');

    function render(items){
      $res.innerHTML = items.length
        ? items.map(i => `
          <a class="card outbound" href="${i.href}" rel="nofollow sponsored" target="_blank" data-label="${i.title}">
            <h3>${i.title}</h3>
            <div class="badges">${i.badges.map(b=>`<span class="badge">${b}</span>`).join('')}</div>
          </a>
        `).join('')
        : `<div style="opacity:.75;text-align:center;padding:26px 0;">Skriv i feltet ovenfor og tryk SÃ¸g.</div>`;
    }
    function update(){ render(createIdeas($q.value)); }

    $q.addEventListener('keydown', e => { if (e.key === 'Enter') update(); });
    $btn.addEventListener('click', update);

    // GA4 outbound-click event
    document.addEventListener('click', (e)=>{
      const a = e.target.closest('a.outbound'); if(!a) return;
      try {
        gtag('event', 'outbound_click', {
          event_category: 'affiliate',
          event_label: a.dataset.label || a.href
        });
      } catch(_) {}
    });

    // init
    update();
  </script>
</body>
</html>
