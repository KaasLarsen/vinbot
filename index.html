<!doctype html>
<html lang="da">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vinbot â€“ find vin pÃ¥ sekunder</title>
  <meta name="description" content="Find den perfekte vin til mad, humÃ¸r eller lejlighed. Vinbot sammenligner priser og viser de bedste flasker fra danske vinhandlere." />
  <link rel="icon" type="image/png" href="/assets/vinbot-logo.png" />
  <link rel="stylesheet" href="/assets/style.css" />
</head>
<body>
  <!-- HEADER PARTIAL -->
  <nav class="nav">
    <a class="brand" href="/">
      <span class="brand-logo">
        <img src="/assets/vinbot-logo.png" alt="Vinbot logo" />
      </span>
      <h1>Vinbot</h1>
    </a>
    <ul class="main-nav">
      <li><a href="/">SÃ¸g</a></li>
      <li><a href="/vin-til/">Vin til Mad</a></li>
      <li><a href="/druer/">Druer</a></li>
      <li><a href="/pris/">Pris</a></li>
      <li><a href="/anbefalinger/">Anbefalinger</a></li>
      <li><a href="/blog/">Blog</a></li>
    </ul>
  </nav>

  <div class="hero">
    <h1>Find vin pÃ¥ sekunder</h1>
    <p>FortÃ¦l hvad du er i humÃ¸r til â€“ <strong>drue</strong>, <strong>mad</strong>, <strong>pris</strong> eller <strong>lejlighed</strong>. Vinbot guider dig til de bedste flasker og butikker.</p>
  </div>

  <div class="search-wrap">
    <div class="search">
      <span class="icon">ğŸ”</span>
      <input id="q" type="text" placeholder="fx Barolo til bÃ¸f under 150 kr" onkeydown="if(event.key==='Enter'){doSearch()}" />
      <button class="btn-primary" onclick="doSearch()">SÃ¸g</button>
    </div>
    <p class="search-hint">Tryk <kbd>Enter</kbd> eller brug mobilens â€œSÃ¸gâ€</p>
  </div>

  <div id="results" class="wrap"></div>

  <!-- FOOTER PARTIAL -->
  <footer>
    <div>Â© <span id="y"></span> Vinbot.dk Â· Alle rettigheder forbeholdes</div>
    <div class="footer-links">
      <a href="/pages/om-os.html">om os</a> Â·
      <a href="/pages/kontakt.html">kontakt</a> Â·
      <a href="/pages/betingelser.html">betingelser</a> Â·
      <a href="/pages/privatliv.html">privatliv</a>
    </div>
    <div class="socials" aria-label="sociale medier">
      <a class="fb" href="https://facebook.com" target="_blank" rel="noopener nofollow" aria-label="Facebook">
        <svg viewBox="0 0 24 24" width="18" height="18" fill="#cfc7bd" aria-hidden="true">
          <path d="M22 12.06C22 6.48 17.52 2 11.94 2 6.36 2 1.88 6.48 1.88 12.06c0 4.98 3.64 9.12 8.4 9.94v-7.03H7.9v-2.91h2.38V9.48c0-2.35 1.4-3.65 3.54-3.65 1.03 0 2.1.18 2.1.18v2.31h-1.18c-1.16 0-1.52.72-1.52 1.46v1.75h2.59l-.41 2.91h-2.18V22c4.76-.82 8.4-4.96 8.4-9.94z"/>
        </svg>
      </a>
    </div>
  </footer>

  <script>
    document.getElementById('y').textContent = new Date().getFullYear();

    // --- INTELLIGENT INTENT DETECTION ---
    const FOOD_TO_WINES = {
      "ost":["portvin","riesling","chardonnay","sauternes"],
      "pizza":["chianti","barbera","primitivo"],
      "bÃ¸f":["barolo","cabernet sauvignon","syrah"],
      "oksekÃ¸d":["cabernet","syrah","malbec"],
      "lam":["syrah","rioja","ribera del duero"],
      "svin":["pinot noir","riesling"],
      "fisk":["riesling","chablis","albariÃ±o"],
      "sushi":["riesling","sauvignon blanc","crÃ©mant"],
      "tapas":["rioja","garnacha","cava"],
      "dessert":["sauternes","portvin","moscato"]
    };
    const MOOD_TO_WINES = {
      "sommer":["rosÃ©","sauvignon blanc","crÃ©mant"],
      "terrasse":["rosÃ©","cava","prosecco"],
      "hygge":["primitivo","zinfandel","malbec"],
      "romantisk":["pinot noir","champagne"]
    };
    const SYN = { "shiraz":"syrah","cremant":"crÃ©mant","rose":"rosÃ©","barolo":"nebbiolo","rioja":"tempranillo","ribera":"ribera del duero" };

    function planFromText(raw){
      const q = (raw||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");
      const terms = new Set([q]);
      Object.keys(FOOD_TO_WINES).forEach(k=>{ if(q.includes(k)) FOOD_TO_WINES[k].forEach(v=>terms.add(v)); });
      Object.keys(MOOD_TO_WINES).forEach(k=>{ if(q.includes(k)) MOOD_TO_WINES[k].forEach(v=>terms.add(v)); });
      Object.keys(SYN).forEach(k=>{ if(q.includes(k)) terms.add(SYN[k]); });
      if(terms.size===1) q.split(/\s+/).forEach(t=>t&&terms.add(t));
      // Budget
      let max=null; const m=q.match(/(?:under|max)\s*(\d{2,4})\s*kr/); if(m) max=parseInt(m[1],10);
      if(/billig|budget/.test(q)) max=Math.min(max??9999,100);
      return {terms:[...terms], max};
    }

    async function doSearch(){
      const input = document.getElementById('q');
      const query = input.value.trim();
      if(!query) return;

      const {terms, max} = planFromText(query);
      const qForApi = terms.join(" ");
      document.getElementById("results").innerHTML = `<p class="msg info">ğŸ” SÃ¸ger efter vin...</p>`;

      const r = await fetch(`/api/search?q=${encodeURIComponent(qForApi)}${max?`&max=${max}`:""}`, {cache:"no-store"});
      const data = await r.json();

      if(!data.products || !data.products.length){
        document.getElementById("results").innerHTML = `<p class="msg err">Ingen resultater for â€œ${query}â€.</p>`;
        return;
      }

      const html = data.products.map(p=>`
        <a class="card product" href="${p.url}" target="_blank" rel="noopener nofollow">
          <div class="card-media">
            ${p.image ? `<img src="${p.image}" alt="${p.title}">` : `<div class="img-fallback">ğŸ·</div>`}
          </div>
          <div class="card-body">
            <h3>${p.title}</h3>
            <div class="badges">
              ${p.price ? `<span class="badge">${p.price.toLocaleString("da-DK",{style:"currency",currency:"DKK"})}</span>` : ""}
              ${p.merchant ? `<span class="badge">${p.merchant}</span>` : ""}
            </div>
          </div>
        </a>`).join("");
      document.getElementById("results").innerHTML = `<div class="grid">${html}</div>`;
    }
  </script>
</body>
</html>
